<div class="container my-5">
  <div class="row justify-content-center">
    <!-- Componente Carousel (MDBoostrap) -->
    <div class="col-md-10">
      <mdb-carousel [controls]="true" [indicators]="true" [animation]="'fade'">
        <mdb-carousel-item>
          <img
            src="https://mdbcdn.b-cdn.net/img/new/slides/041.webp"
            class="d-block w-100"
            alt="Nature 1"
          />
          <div class="carousel-caption d-none d-md-block">
            <h5>Primer Slide</h5>
            <p>Descripción del primer slide del carousel.</p>
          </div>
        </mdb-carousel-item>

        <mdb-carousel-item>
          <img
            src="https://mdbcdn.b-cdn.net/img/new/slides/042.webp"
            class="d-block w-100"
            alt="Nature 2"
          />
          <div class="carousel-caption d-none d-md-block">
            <h5>Segundo Slide</h5>
            <p>Descripción del segundo slide del carousel.</p>
          </div>
        </mdb-carousel-item>

        <mdb-carousel-item>
          <img
            src="https://mdbcdn.b-cdn.net/img/new/slides/043.webp"
            class="d-block w-100"
            alt="Nature 3"
          />
          <div class="carousel-caption d-none d-md-block">
            <h5>Tercer Slide</h5>
            <p>Descripción del tercer slide del carousel.</p>
          </div>
        </mdb-carousel-item>
      </mdb-carousel>
    </div>
  </div>
</div>

<div class="container my-5">
  <h2 class="text-center mb-4">Productos Destacados</h2>

  <!-- Dividimos los productos en filas de 4 elementos cada una -->
  <div *ngFor="let fila of obtenerFilasProductos(); let i = index" class="product-row">
    
    <!-- Fila de cards -->
    <div class="row">
      <div
        class="col-md-4 col-lg-3 mb-4 d-flex align-items-stretch"
        *ngFor="let producto of fila"
      >
        <mat-card
          class="h-100 product-card w-100"
          (click)="seleccionarProducto(producto, i)"
          style="cursor: pointer; transition: transform 0.3s;"
          [class.selected]="productoSeleccionado?.nombre === producto.nombre"
        >
          <img
            mat-card-image
            [src]="producto.imagenUrl"
            [alt]="producto.nombre"
            style="height: 200px; object-fit: cover;"
          />
          <mat-card-content>
            <h3>{{ producto.nombre }}</h3>
            <p class="price">
              {{ producto.precio | currency : 'USD' : 'symbol' : '1.2-2' }}
            </p>
            <mat-chip
              [color]="
                producto.tipoEnvio === 'Envío gratis'
                  ? 'primary'
                  : producto.tipoEnvio === 'Envío express'
                  ? 'accent'
                  : 'warn'
              "
              highlighted
            >
              {{ producto.tipoEnvio }}
            </mat-chip>
          </mat-card-content>
          <mat-card-actions>
            <button mat-raised-button color="primary">Comprar</button>
            <button mat-button>Detalles</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>

    <!-- Panel de información que aparece debajo de la fila donde se hizo click -->
    <div class="row mt-2" *ngIf="filaSeleccionada === i && productoSeleccionado">
      <div class="col-12">
        <ng-container>
          <div class="info-panel p-4 rounded shadow-lg bg-light">
            <!-- REQUISITO 4: h1 con ngClass -->
            <h1
              [ngClass]="{
                'text-primary': productoSeleccionado.precio > 100,
                'text-success': productoSeleccionado.precio <= 100,
                'mb-3': true
              }"
            >
              Producto Seleccionado: 
              <span
                [ngStyle]="{
                  'font-size': productoSeleccionado.precio > 100 ? 'x-large' : 'large'
                }"
              >
                {{ productoSeleccionado.nombre }}
              </span>
            </h1>

            <!-- REQUISITO 4: span con ngClass -->
            <span
              class="badge p-2 mb-3 d-inline-block"
              [ngClass]="{
                'bg-danger': productoSeleccionado.precio > 100,
                'bg-info': productoSeleccionado.precio <= 100
              }"
              [style.font-size]="productoSeleccionado.precio > 100 ? '1.3rem' : '1.1rem'"
            >
              Precio: {{ productoSeleccionado.precio | currency : 'USD' : 'symbol' : '1.2-2' }}
            </span>

            <!-- REQUISITO 4: p para la descripción -->
            <p
              class="text-muted fst-italic mt-3"
              [ngClass]="{
                'fw-bold': productoSeleccionado.precio > 100,
                'fw-normal': productoSeleccionado.precio <= 100
              }"
              [style.font-size]="productoSeleccionado.precio > 100 ? '1.2rem' : '1rem'"
            >
              <strong>Descripción:</strong> {{ productoSeleccionado.descripcion }}
            </p>

            <!-- Información adicional -->
            <p
              class="mt-2"
              [ngClass]="{
                'text-warning': productoSeleccionado.tipoEnvio === 'Envío express',
                'text-dark': productoSeleccionado.tipoEnvio !== 'Envío express'
              }"
            >
              <strong>Tipo de envío:</strong> {{ productoSeleccionado.tipoEnvio }}
            </p>

            <button 
              mat-raised-button 
              color="warn" 
              (click)="cerrarPanel()"
              class="mt-3"
            >
              Cerrar Detalles
            </button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay producto seleccionado -->
  <div class="row mt-4" *ngIf="!productoSeleccionado">
    <div class="col-12">
      <div class="text-center p-4 bg-light rounded">
        <p class="text-muted mb-0">
          Haz clic en cualquier tarjeta de producto para ver sus detalles aquí.
        </p>
      </div>
    </div>
  </div>
</div>